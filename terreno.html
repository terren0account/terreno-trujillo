<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Interactivo</title>
    <style>
        body {
            margin: 0;
            min-height: 100vh;
            background: #1a1a1a;
            color: #fff;
            font-family: Arial, sans-serif;
            display: grid;
            place-items: center;
        }

        #map-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
            border-radius: 0;
            background: #000;
            touch-action: none;
        }

        #map {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: center;
            max-width: none;
            cursor: grab;
        }

        .panel {
            position: absolute;
            border-radius: 8px;
            background: #282828e6;
            z-index: 1000;
            font-size: 14px;
        }

        #controls {
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 10px;
        }

        #info {
            top: 10px;
            left: 10px;
            font-size: 12px;
            padding: 5px;
        }

        .btn {
            padding: 10px 15px;
            border: 2px solid #2196F3;
            border-radius: 4px;
            background: transparent;
            color: #2196F3;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn:hover { 
            background: #2196F3;
            color: white;
        }

        .btn:active { 
            transform: scale(0.98); 
        }

        .btn:disabled { 
            background: #555;
            cursor: not-allowed;
        }

        #zoomSliderContainer {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        #zoomSlider {
            width: 100%;
        }

        #zoomLevel {
            text-align: center;
        }

        /* Bot√≥n de inicio */
        #goHome {
            position: absolute;
            bottom: 10px;
            left: 10px;
            padding: 10px 15px;
            border: 2px solid #ff5722;
            background-color: transparent;
            color: #ff5722;
            border-radius: 8px;
            cursor: pointer;
            z-index: 1000;
        }

        #goHome:hover {
            background-color: #ff5722;
            color: white;
        }
    </style>
</head>
<body>
    <div id="map-container">
        <img id="map" src="mapa.svg" alt="Mapa" draggable="false">
        
        <div id="controls" class="panel">
            <div id="zoomSliderContainer">
                <input type="range" id="zoomSlider" min="50" max="300" value="100">
                <div id="zoomLevel">100%</div>
            </div>
            <button id="reset" class="btn">Reset</button>
        </div>

        <div id="info" class="panel">
            <div>Pellizcar para zoom</div>
            <div>Arrastrar: mover mapa</div>
        </div>

        <button id="goHome">Inicio</button>
    </div>

    <script>
        class MapViewer {
            constructor(containerId) {
                this.container = document.getElementById(containerId);
                this.map = this.container.querySelector('img');
                this.zoomLevel = document.getElementById('zoomLevel');
                this.zoomSlider = document.getElementById('zoomSlider');
                this.resetButton = document.getElementById('reset');

                this.state = {
                    scale: 1,
                    x: 0,
                    y: 0,
                    initialScale: 1,
                    initialX: 0,
                    initialY: 0,
                    isDragging: false,
                    bounds: null,
                    lastTouchDistance: null
                };

                this.config = {
                    minZoom: 0.5,
                    maxZoom: 3,
                    zoomStep: 1.1
                };

                this.init();
            }

            init() {
                this.map.onload = () => this.setInitialState();
                this.container.onmousedown = e => this.startDrag(e.clientX, e.clientY);
                this.container.ontouchstart = e => this.startTouch(e);
                this.container.onmousemove = e => this.drag(e.clientX, e.clientY);
                this.container.ontouchmove = e => this.dragTouch(e);
                this.container.onwheel = e => this.handleZoom(e);
                
                ['mouseup', 'mouseleave', 'touchend'].forEach(event => 
                    this.container.addEventListener(event, () => this.state.isDragging = false));

                this.zoomSlider.oninput = () => this.setZoomFromSlider();
                this.resetButton.onclick = () => this.reset();
                document.getElementById('goHome').onclick = () => window.location.href = 'index.html';
            }

            setInitialState() {
                const container = this.container.getBoundingClientRect();
                const map = this.map.getBoundingClientRect();

                this.state.initialX = (container.width - map.width) / 2;
                this.state.initialY = (container.height - map.height) / 2;

                this.state.x = this.state.initialX;
                this.state.y = this.state.initialY;

                this.updateTransform();
            }

            startDrag(x, y) {
                this.state.isDragging = true;
                this.state.lastX = x - this.state.x;
                this.state.lastY = y - this.state.y;
            }

            startTouch(e) {
                if (e.touches.length === 2) {
                    this.state.lastTouchDistance = this.getTouchDistance(e);
                } else {
                    this.startDrag(e.touches[0].clientX, e.touches[0].clientY);
                }
            }

            drag(x, y) {
                if (!this.state.isDragging) return;
                this.state.x = x - this.state.lastX;
                this.state.y = y - this.state.lastY;
                this.updateTransform();
            }

            dragTouch(e) {
                if (e.touches.length === 2) {
                    const distance = this.getTouchDistance(e);
                    const scaleChange = distance / this.state.lastTouchDistance;
                    this.zoom(scaleChange > 1);
                    this.state.lastTouchDistance = distance;
                } else {
                    this.drag(e.touches[0].clientX, e.touches[0].clientY);
                }
            }

            getTouchDistance(e) {
                const dx = e.touches[0].clientX - e.touches[1].clientX;
                const dy = e.touches[0].clientY - e.touches[1].clientY;
                return Math.sqrt(dx * dx + dy * dy);
            }

            handleZoom(e) {
                e.preventDefault();
                const scale = e.deltaY < 0 ? this.config.zoomStep : 1 / this.config.zoomStep;
                this.zoom(scale > 1);
            }

            zoom(isZoomIn) {
                const oldScale = this.state.scale;
                this.state.scale = isZoomIn
                    ? Math.min(this.state.scale * this.config.zoomStep, this.config.maxZoom)
                    : Math.max(this.state.scale / this.config.zoomStep, this.config.minZoom);

                if (oldScale !== this.state.scale) {
                    this.updateTransform();
                }
            }

            setZoomFromSlider() {
                this.state.scale = this.zoomSlider.value / 100;
                this.updateTransform();
            }

            reset() {
                this.state.scale = this.state.initialScale;
                this.state.x = this.state.initialX;
                this.state.y = this.state.initialY;
                this.updateTransform();
            }

            updateTransform() {
                this.map.style.transform = `translate(-50%, -50%) scale(${this.state.scale}) translate(${this.state.x}px, ${this.state.y}px)`;
            }
        }

        new MapViewer('map-container');
    </script>
</body>
</html>
