<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Interactivo</title>
    <style>
        body {
            margin: 0;
            min-height: 100vh;
            background: #1a1a1a;
            color: #fff;
            font-family: Arial, sans-serif;
            display: grid;
            place-items: center;
        }

        #map-container {
            width: 90vw;
            height: 90vh;
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            background: #000;
            box-shadow: 0 4px 6px #0003;
        }

        #map {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: center;
            transition: transform 0.2s;
            max-width: none;
            cursor: grab;
        }

        .panel {
            position: absolute;
            right: 10px;
            padding: 15px;
            border-radius: 8px;
            background: #282828e6;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            font-size: 14px;
        }

        #controls { top: 20px; }
        #info { bottom: 20px; }

        .btn {
            padding: 10px 15px;
            border: 2px solid #2196F3;
            border-radius: 0px;
            background: transparent;
            color: #2196F3;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn:hover { 
            background: #2196F3;
            color: white;
        }

        .btn:active { 
            transform: scale(0.98); 
        }

        .btn:disabled { 
            background: #555;
            cursor: not-allowed;
        }

        /* Estilos para pantallas peque침as */
        @media (max-width: 600px) {
            .panel {
                font-size: 12px;
                right: 5px;
            }

            #controls {
                top: 10px;
            }

            #info {
                bottom: 10px;
            }

            .btn {
                padding: 8px 12px;
                font-size: 12px;
            }
        }

        /* Estilo para el bot칩n de inicio */
        #goHome {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 10px 15px;
            border: 2px solid #ff5722;
            background-color: transparent;
            color: #ff5722;
            border-radius: 8px;
            cursor: pointer;
            z-index: 1000;
        }

        #goHome:hover {
            background-color: #ff5722;
            color: white;
        }
    </style>
</head>
<body>
    <div id="map-container">
        <img id="map" src="mapa.svg" alt="Mapa" draggable="false">
        
        <div id="controls" class="panel">
            <button id="zoomIn" class="btn">+</button>
            <div id="zoomLevel">100%</div>
            <button id="zoomOut" class="btn">-</button>
            <button id="reset" class="btn">Reset</button>
        </div>

        <div id="info" class="panel">
            <div>Rueda del rat칩n: zoom</div>
            <div>Click + arrastrar: mover</div>
        </div>

        <button id="goHome">Ir a Inicio</button>
    </div>

    <script>
        class MapViewer {
            constructor(containerId) {
                this.container = document.getElementById(containerId);
                this.map = this.container.querySelector('img');
                this.zoomLevel = document.getElementById('zoomLevel');

                this.state = {
                    scale: 1,
                    x: 0,
                    y: 0,
                    initialScale: 1,
                    initialX: 0,
                    initialY: 0,
                    isDragging: false,
                    bounds: null,
                    lastTouchDistance: null
                };

                this.config = {
                    minZoom: 0.5,
                    maxZoom: 3,
                    zoomStep: 1.1,
                    moveLimit: 100
                };

                this.init();
            }

            init() {
                this.map.onload = () => this.setInitialState();
                this.container.onmousedown = e => this.startDrag(e.clientX, e.clientY);
                this.container.ontouchstart = e => this.startTouch(e);
                this.container.onmousemove = e => this.drag(e.clientX, e.clientY);
                this.container.ontouchmove = e => this.dragTouch(e);
                this.container.onwheel = e => this.handleZoom(e);
                
                ['mouseup', 'mouseleave', 'touchend'].forEach(event => 
                    this.container.addEventListener(event, () => this.state.isDragging = false));

                document.getElementById('zoomIn').onclick = () => this.zoom(true);
                document.getElementById('zoomOut').onclick = () => this.zoom(false);
                document.getElementById('reset').onclick = () => this.reset();

                window.onresize = () => {
                    this.updateBounds();
                    this.clampPosition();
                };

                // Bot칩n "Ir a Inicio"
                document.getElementById('goHome').onclick = () => window.location.href = 'index.html';
            }

            setInitialState() {
                this.updateBounds();
                const container = this.container.getBoundingClientRect();
                const map = this.map.getBoundingClientRect();

                this.state.initialX = (container.width - map.width) / 2;
                this.state.initialY = (container.height - map.height) / 2;

                this.state.x = this.state.initialX;
                this.state.y = this.state.initialY;

                this.updateTransform();
            }

            startDrag(x, y) {
                this.state.isDragging = true;
                this.state.lastX = x - this.state.x;
                this.state.lastY = y - this.state.y;
            }

            startTouch(e) {
                if (e.touches.length == 2) {
                    this.state.lastTouchDistance = this.getTouchDistance(e);
                } else {
                    this.startDrag(e.touches[0].clientX, e.touches[0].clientY);
                }
            }

            drag(x, y) {
                if (!this.state.isDragging) return;
                this.state.x = x - this.state.lastX;
                this.state.y = y - this.state.lastY;
                this.clampPosition();
                this.updateTransform();
            }

            dragTouch(e) {
                if (e.touches.length == 2) {
                    const distance = this.getTouchDistance(e);
                    const scaleChange = distance / this.state.lastTouchDistance;
                    this.zoom(scaleChange > 1, { x: e.touches[0].clientX, y: e.touches[0].clientY });
                    this.state.lastTouchDistance = distance;
                } else {
                    this.drag(e.touches[0].clientX, e.touches[0].clientY);
                }
            }

            getTouchDistance(e) {
                const dx = e.touches[0].clientX - e.touches[1].clientX;
                const dy = e.touches[0].clientY - e.touches[1].clientY;
                return Math.sqrt(dx * dx + dy * dy);
            }

            handleZoom(e) {
                e.preventDefault();
                const rect = this.container.getBoundingClientRect();
                const point = { x: rect.width / 20, y: rect.height / 2 };

                this.zoom(e.deltaY < 0, point);
            }

            zoom(isZoomIn, point = null) {
                const oldScale = this.state.scale;
                this.state.scale = isZoomIn
                    ? Math.min(this.state.scale * this.config.zoomStep, this.config.maxZoom)
                    : Math.max(this.state.scale / this.config.zoomStep, this.config.minZoom);

                if (oldScale !== this.state.scale) {
                    if (!point) {
                        const rect = this.container.getBoundingClientRect();
                        point = { x: rect.width / 20, y: rect.height / 2 };
                    }

                    const scale = this.state.scale / oldScale;
                    this.state.x = point.x - (point.x - this.state.x) * scale;
                    this.state.y = point.y - (point.y - this.state.y) * scale;

                    this.updateBounds();
                    this.clampPosition();
                    this.updateTransform();
                    this.updateZoomLevel();
                }
            }

            updateBounds() {
                const container = this.container.getBoundingClientRect();
                const map = this.map.getBoundingClientRect();
                const extra = (this.config.moveLimit / 100) * Math.max(map.width, map.height);

                this.state.bounds = {
                    minX: container.width - map.width - extra,
                    maxX: extra,
                    minY: container.height - map.height - extra,
                    maxY: extra
                };
            }

            clampPosition() {
                if (!this.state.bounds) return;

                this.state.x = Math.max(this.state.bounds.minX, 
                                      Math.min(this.state.bounds.maxX, this.state.x));
                this.state.y = Math.max(this.state.bounds.minY, 
                                      Math.min(this.state.bounds.maxY, this.state.y));
            }

            reset() {
                this.state.scale = this.state.initialScale;
                this.state.x = this.state.initialX;
                this.state.y = this.state.initialY;

                this.updateTransform();
                this.updateZoomLevel();
            }

            updateTransform() {
                this.map.style.transform = 
                    `translate(-50%, -50%) scale(${this.state.scale}) 
                     translate(${this.state.x / this.state.scale}px, ${this.state.y / this.state.scale}px)`;
            }

            updateZoomLevel() {
                this.zoomLevel.textContent = `${Math.round(this.state.scale * 100)}%`;
                document.getElementById('zoomIn').disabled = this.state.scale >= this.config.maxZoom;
                document.getElementById('zoomOut').disabled = this.state.scale <= this.config.minZoom;
            }
        }

        // Inicializar
        new MapViewer('map-container');
    </script>
</body>
</html>
