<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mapa Interactivo</title>
    <style>
        body {
            margin: 0;
            min-height: 100vh;
            background: #1a1a1a;
            color: #fff;
            font-family: Arial, sans-serif;
            display: grid;
            place-items: center;
            overflow: hidden; /* Previene scroll indeseado */
        }

        #map-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
            background: #000;
            box-shadow: 0 4px 6px #0003;
            touch-action: none;
        }

        #map {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: center;
            transition: transform 0.2s;
            max-width: none;
            cursor: grab;
            width: auto;
            height: auto;
            max-height: 90vh;
        }

        .panel {
            position: fixed; /* Cambiado a fixed para mejor posicionamiento */
            padding: 15px;
            border-radius: 8px;
            background: #282828e6;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            font-size: 14px;
            touch-action: none;
        }

        #controls { 
            top: 20px;
            right: 20px;
            width: auto;
        }

        #info { 
            bottom: 20px;
            right: 20px;
            width: auto;
        }

        .btn {
            padding: 12px 20px; /* Botones más grandes para móvil */
            border: 2px solid #2196F3;
            border-radius: 8px;
            background: #2196F3;
            color: white;
            cursor: pointer;
            transition: 0.2s;
            font-size: 16px;
            min-width: 100px; /* Ancho mínimo para mejor tap target */
            touch-action: manipulation;
        }

        .btn:active { 
            transform: scale(0.98); 
            background: #1976D2;
        }

        #goHome {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 12px 20px;
            border: 2px solid #ff5722;
            background-color: #ff5722;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            z-index: 1000;
            font-size: 16px;
            min-width: 100px;
            touch-action: manipulation;
        }

        #goHome:active {
            background-color: #f4511e;
            transform: scale(0.98);
        }

        /* Estilos específicos para móvil */
        @media (max-width: 768px) {
            .panel {
                padding: 10px;
            }

            #controls {
                top: 10px;
                right: 10px;
            }

            #info {
                bottom: 10px;
                right: 10px;
            }

            #zoomSlider {
                width: 150px;
                height: 30px; /* Más alto para mejor control táctil */
            }

            .btn, #goHome {
                padding: 10px 15px;
                font-size: 14px;
            }
        }

        /* Mejoras para el slider */
        #zoomSlider {
            width: 100%;
            margin: 10px 0;
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            background: #2196F3;
            border-radius: 3px;
            outline: none;
        }

        #zoomSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
        }

        #zoomLevel {
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="map-container">
        <img id="map" src="mapa.svg" alt="Mapa" draggable="false">
        
        <div id="controls" class="panel">
            <div id="zoomSliderContainer">
                <input type="range" id="zoomSlider" min="50" max="300" value="100">
                <div id="zoomLevel">100%</div>
            </div>
            <button id="reset" class="btn">Reset</button>
        </div>

        <div id="info" class="panel">
            <div>Pellizcar: zoom</div>
            <div>Tocar + arrastrar: mover</div>
        </div>

        <button id="goHome" onclick="window.location.href='index.html'">Ir a Inicio</button>
    </div>

    <script>
        class MapViewer {
            constructor(containerId) {
                this.container = document.getElementById(containerId);
                this.map = this.container.querySelector('img');
                this.zoomLevel = document.getElementById('zoomLevel');
                this.zoomSlider = document.getElementById('zoomSlider');
                this.resetButton = document.getElementById('reset');
                this.homeButton = document.getElementById('goHome');

                this.state = {
                    scale: 1,
                    x: 0,
                    y: 0,
                    initialScale: 1,
                    initialX: 0,
                    initialY: 0,
                    isDragging: false,
                    bounds: null,
                    lastTouchDistance: null,
                    lastTouchX: 0,
                    lastTouchY: 0
                };

                this.config = {
                    minZoom: 0.5,
                    maxZoom: 3,
                    zoomStep: 1.1,
                    moveLimit: 100
                };

                this.init();
            }

            init() {
                // Asegurarse de que la imagen esté cargada
                if (this.map.complete) {
                    this.setInitialState();
                } else {
                    this.map.onload = () => this.setInitialState();
                }

                // Eventos táctiles
                this.container.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.handleTouchStart(e);
                }, { passive: false });

                this.container.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    this.handleTouchMove(e);
                }, { passive: false });

                this.container.addEventListener('touchend', () => {
                    this.state.isDragging = false;
                    this.state.lastTouchDistance = null;
                });

                // Eventos de mouse
                this.container.addEventListener('mousedown', (e) => this.startDrag(e.clientX, e.clientY));
                this.container.addEventListener('mousemove', (e) => this.drag(e.clientX, e.clientY));
                this.container.addEventListener('mouseup', () => this.state.isDragging = false);
                this.container.addEventListener('mouseleave', () => this.state.isDragging = false);
                this.container.addEventListener('wheel', (e) => this.handleZoom(e));

                // Control de zoom
                this.zoomSlider.addEventListener('input', () => this.setZoomFromSlider());
                
                // Botón de reset
                this.resetButton.addEventListener('click', () => this.reset());
                
                // Botón de inicio
                this.homeButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.href = 'index.html';
                });

                // Prevenir zoom del navegador en doble tap
                this.container.addEventListener('dblclick', (e) => e.preventDefault());

                // Centrar el mapa inicialmente
                this.centerMap();
            }

            centerMap() {
                const containerRect = this.container.getBoundingClientRect();
                const mapRect = this.map.getBoundingClientRect();
                
                this.state.x = (containerRect.width - mapRect.width) / 2;
                this.state.y = (containerRect.height - mapRect.height) / 2;
                
                this.updateTransform();
            }

            handleTouchStart(e) {
                if (e.touches.length === 2) {
                    this.state.lastTouchDistance = this.getTouchDistance(e.touches);
                } else if (e.touches.length === 1) {
                    this.state.lastTouchX = e.touches[0].clientX;
                    this.state.lastTouchY = e.touches[0].clientY;
                    this.state.isDragging = true;
                }
            }

            handleTouchMove(e) {
                if (e.touches.length === 2) {
                    const newDistance = this.getTouchDistance(e.touches);
                    if (this.state.lastTouchDistance) {
                        const scale = newDistance / this.state.lastTouchDistance;
                        const center = {
                            x: (e.touches[0].clientX + e.touches[1].clientX) / 2,
                            y: (e.touches[0].clientY + e.touches[1].clientY) / 2
                        };
                        this.zoom(scale > 1, center);
                    }
                    this.state.lastTouchDistance = newDistance;
                } else if (e.touches.length === 1 && this.state.isDragging) {
                    const deltaX = e.touches[0].clientX - this.state.lastTouchX;
                    const deltaY = e.touches[0].clientY - this.state.lastTouchY;
                    
                    this.state.x += deltaX;
                    this.state.y += deltaY;
                    
                    this.state.lastTouchX = e.touches[0].clientX;
                    this.state.lastTouchY = e.touches[0].clientY;
                    
                    this.clampPosition();
                    this.updateTransform();
                }
            }

            getTouchDistance(touches) {
                const dx = touches[0].clientX - touches[1].clientX;
                const dy = touches[0].clientY - touches[1].clientY;
                return Math.sqrt(dx * dx + dy * dy);
            }

            setInitialState() {
                this.updateBounds();
                const container = this.container.getBoundingClientRect();
                const map = this.map.getBoundingClientRect();

                this.state.initialScale = Math.min(
                    container.width / map.width,
                    container.height / map.height
                );
                
                this.state.scale = this.state.initialScale;
                this.centerMap();
                this.updateZoomLevel();
            }

            startDrag(x, y) {
                this.state.isDragging = true;
                this.state.lastX = x - this.state.x;
                this.state.lastY = y - this.state.y;
            }

            drag(x, y) {
                if (!this.state.isDragging) return;
                
                this.state.x = x - this.state.lastX;
                this.state.y = y - this.state.lastY;
                
                this.clampPosition();
                this.updateTransform();
            }

            handleZoom(e) {
                e.preventDefault();
                const rect = this.container.getBoundingClientRect();
                const point = {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
                this.zoom(e.deltaY < 0, point);
            }

            zoom(isZoomIn, point) {
                const oldScale = this.state.scale;
                const newScale = isZoomIn
                    ? Math.min(this.state.scale * this.config.zoomStep, this.config.maxZoom)
                    : Math.max(this.state.scale / this.config.zoomStep, this.config.minZoom);
                
                if (oldScale !== newScale) {
                    this.state.scale = newScale;
                    
                    if (point) {
                        const scale = newScale / oldScale;
                        this.state.x = point.x - (point.x - this.state.x) * scale;
                        this.state.y = point.y - (point.y - this.state.y) * scale;
                    }
                    
                    this.updateBounds();
                    this.clampPosition();
                    this.updateTransform();
                    this.updateZoomLevel();
                    this.zoomSlider.value = Math.round(this.state.scale * 100);
                }
            }

            setZoomFromSlider() {
                const newScale = this.zoomSlider.value / 100;
                if (newScale !== this.state.scale) {
                    const center = {
                        x: this.container.clientWidth / 2,
                        y: this.container.clientHeight / 2
                    };
                    this.zoom(newScale > this.state.scale, center);
                }
            }

            updateBounds() {
                const container = this.container.getBoundingClientRect();
                const map = this.map.getBoundingClientRect();
                const scaledWidth = map.width * this.state.scale;
                const scaledHeight = map.height * this.state.scale;
                
                this.state.bounds = {
                    minX: container.width - scaledWidth,
                    maxX: 0,
                    minY: container.height - scaledHeight,
                    maxY: 0
                };
            }

            clampPosition() {
                if (!this.state.bounds) return;
                
                this.state.x = Math.max(this.state.bounds.minX, 
                                      Math.min(this.state.bounds.maxX, this.state.x));
                this.state.y = Math.max(this.state.bounds.minY, 
                                      Math.min(this.state.bounds.maxY, this.state.y));
            }

            reset() {
                this.state.scale = this.state.initialScale;
                this.centerMap();
                this.updateZoomLevel();
                this.zoomSlider.value = Math.round(this.state.scale * 100);
            }

            updateTransform() {
                requestAnimationFrame(() => {
                    this.map.style.transform = `translate(${this.state.x}px, ${this.state.y}px) scale(${this.state.scale})`;
                });
            }

            updateZoomLevel() {
                this.zoomLevel.textContent = `${Math.round(this.state.scale * 100)}%`;
            }
        }

        // Inicializar el visor del mapa
// Inicializar el visor del mapa
                const mapViewer = new MapViewer('map-container');

                // Prevenir el comportamiento por defecto de algunos gestos móviles
                document.addEventListener('gesturestart', (e) => e.preventDefault());
                document.addEventListener('gesturechange', (e) => e.preventDefault());
                document.addEventListener('gestureend', (e) => e.preventDefault());
            </script>
        </body>
        </html>
